<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Le Voile du Manoir</title>
<style>
  :root{
    --accent:#86c08a;
    --gold:#f1c40f;
    --text:#eee;
    --red:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;
    margin:0;
    font-family:system-ui,-apple-system,sans-serif;
    background:linear-gradient(135deg,#0a0e27 0%,#1a1033 100%);
    color:var(--text);
    -webkit-user-select:none;
    user-select:none;
  }
  
  .wrap{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:16px;
    gap:16px;
  }
  
  .card{
    width:100%;
    max-width:650px;
    background:rgba(20,20,35,0.85);
    border:2px solid rgba(255,107,107,0.3);
    border-radius:16px;
    overflow:hidden;
    backdrop-filter:blur(10px);
    box-shadow:0 8px 32px rgba(0,0,0,0.3);
  }
  
  .image-section{
    position:relative;
    width:100%;
    aspect-ratio:1;
    background:linear-gradient(180deg,rgba(0,0,0,0.6),rgba(0,0,0,0.9));
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }
  
  .frame{
    width:90%;
    height:90%;
    border-radius:12px;
    overflow:hidden;
    background:#000;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    border:2px solid rgba(255,107,107,0.4);
    cursor:pointer;
    transition:all 0.3s ease;
  }
  
  .frame:active{
    transform:scale(0.98);
  }
  
  .frame img{
    width:100%;
    height:100%;
    object-fit:contain;
    filter:blur(45px) brightness(0.35) contrast(0.75);
    transition:filter 800ms cubic-bezier(0.34,1.56,0.64,1);
  }
  
  .frame img.revealed{
    filter:none!important;
  }
  
  .veil-indicator{
    position:absolute;
    top:12px;
    right:12px;
    background:rgba(0,0,0,0.95);
    padding:6px 12px;
    border-radius:20px;
    font-size:12px;
    font-weight:700;
    color:var(--red);
    border:1.5px solid rgba(255,107,107,0.6);
    backdrop-filter:blur(5px);
    z-index:10;
  }
  
  .tap-hint{
    position:absolute;
    bottom:12px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.9);
    padding:6px 14px;
    border-radius:20px;
    font-size:11px;
    color:#ffba4a;
    border:1px solid rgba(255,186,74,0.5);
    opacity:0;
    animation:fadeInOut 2s ease-in-out infinite;
    pointer-events:none;
  }
  
  @keyframes fadeInOut{
    0%, 10%, 90%, 100%{opacity:0}
    20%, 80%{opacity:1}
  }
  
  .completion-celebration{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    font-size:56px;
    opacity:0;
    pointer-events:none;
    z-index:20;
    animation:celebrate 1.2s ease-out forwards;
  }
  
  @keyframes celebrate{
    0%{opacity:1;transform:translate(-50%, -50%) scale(0.3) rotate(0deg)}
    80%{opacity:1;transform:translate(-50%, -50%) scale(1.4) rotate(15deg)}
    100%{opacity:0;transform:translate(-50%, -50%) scale(1) rotate(0deg)}
  }
  
  .content{
    padding:20px;
  }
  
  h1{
    margin:0 0 8px;
    font-size:20px;
    text-align:center;
    color:var(--red);
    font-weight:800;
    letter-spacing:1px;
  }
  
  .step-info{
    text-align:center;
    font-size:13px;
    color:#aaa;
    margin-bottom:16px;
    font-weight:600;
  }
  
  .controls{
    display:flex;
    gap:10px;
    margin-bottom:14px;
  }
  
  input[type="text"]{
    flex:1;
    padding:13px 15px;
    border-radius:11px;
    border:1.5px solid rgba(255,107,107,0.3);
    background:rgba(255,255,255,0.04);
    color:#fff;
    font-size:15px;
    outline:none;
    transition:all 0.3s ease;
    -webkit-text-fill-color: #ffffff;
  }
  
  input::placeholder{
    color:#ffba4a;
  }
  
  input:focus{
    border-color:var(--red);
    background:rgba(255,107,107,0.08);
    box-shadow:0 0 0 3px rgba(255,107,107,0.15);
  }
  
  button{
    padding:13px 24px;
    border-radius:11px;
    border:none;
    background:linear-gradient(135deg,#ff6b6b,#ff8787);
    color:#fff;
    font-weight:700;
    cursor:pointer;
    font-size:14px;
    transition:all 0.3s ease;
    white-space:nowrap;
    box-shadow:0 4px 15px rgba(255,107,107,0.3);
  }
  
  button:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 20px rgba(255,107,107,0.5);
  }
  
  button:active{
    transform:translateY(0) scale(0.97);
  }
  
  .feedback{
    min-height:40px;
    padding:10px 14px;
    border-radius:10px;
    font-size:13px;
    text-align:center;
    font-weight:600;
    margin-bottom:14px;
    transition:all 0.3s ease;
    display:none;
    align-items:center;
    justify-content:center;
  }
  
  .ok{
    color:#55d67a;
    background:rgba(85,214,122,0.12);
    border:1.5px solid rgba(85,214,122,0.4);
  }
  
  .warn{
    color:#ffba4a;
    background:rgba(255,186,74,0.12);
    border:1.5px solid rgba(255,186,74,0.4);
  }
  
  .err{
    color:var(--red);
    background:rgba(255,107,107,0.12);
    border:1.5px solid rgba(255,107,107,0.4);
  }
  
  .progress-grid{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:8px;
  }
  
  .progress-item{
    aspect-ratio:1;
    border:2px solid rgba(255,107,107,0.3);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:13px;
    transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
    min-height:44px;
    background:rgba(255,107,107,0.05);
    color:#aaa;
  }
  
  .progress-item.completed{
    background:linear-gradient(135deg,#55d67a,#4ade80);
    border-color:#55d67a;
    color:#0a3d14;
    transform:scale(1.1);
    box-shadow:0 4px 15px rgba(85,214,122,0.3);
  }
  
  .progress-item.current{
    border-color:var(--red);
    background:rgba(255,107,107,0.2);
    transform:scale(1.08);
    box-shadow:0 0 20px rgba(255,107,107,0.5);
    animation:pulse 1.8s ease-in-out infinite;
    color:var(--red);
  }
  
  @keyframes pulse{
    0%, 100%{box-shadow:0 0 20px rgba(255,107,107,0.5)}
    50%{box-shadow:0 0 35px rgba(255,107,107,0.8)}
  }
  
  .victory-msg{
    display:none;
    text-align:center;
    padding:14px;
    background:rgba(85,214,122,0.15);
    border:2px solid #55d67a;
    border-radius:11px;
    color:#55d67a;
    font-weight:800;
    font-size:15px;
    margin-bottom:14px;
    animation:slideIn 0.5s ease-out;
  }
  
  @keyframes slideIn{
    from{opacity:0;transform:translateY(-15px)}
    to{opacity:1;transform:translateY(0)}
  }
  
  .shake{
    animation:shake 0.4s ease-in-out;
  }
  
  @keyframes shake{
    0%,100%{transform:translateX(0)}
    25%{transform:translateX(-8px)}
    75%{transform:translateX(8px)}
  }
  
  @media (max-width:600px){
    .wrap{
      padding:12px;
      gap:12px;
    }
    
    .card{
      border-radius:14px;
    }
    
    .image-section{
      aspect-ratio:0.95;
    }
    
    .content{
      padding:16px;
    }
    
    h1{
      font-size:18px;
      margin-bottom:6px;
    }
    
    .step-info{
      font-size:12px;
      margin-bottom:12px;
    }
    
    input[type="text"]{
      padding:11px 13px;
      font-size:14px;
    }
    
    button{
      padding:11px 20px;
      font-size:13px;
    }
    
    .progress-grid{
      gap:6px;
    }
    
    .progress-item{
      min-height:40px;
      font-size:12px;
    }
    
    .veil-indicator{
      font-size:11px;
      padding:5px 10px;
      top:10px;
      right:10px;
    }
    
    .feedback{
      min-height:36px;
      padding:8px 12px;
      font-size:12px;
    }
  }
  
  :root, body {
    color-scheme: dark;
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <div class="image-section">
        <div class="frame" id="frame">
          <div class="veil-indicator">Voiles: <span id="stage">5/5</span></div>
          <div class="tap-hint" id="tapHint">Appuyez pour voir</div>
          <img id="revealImg" src="./dracula_revelation.png" alt="R√©v√©lation myst√©rieuse" />
        </div>
      </div>

      <div class="content">
        <h1>ü©∏ Voile du Manoir</h1>
        
        <div id="feedback" class="feedback"></div>
        
        <div class="victory-msg" id="victoryMsg">‚ú® Dracula R√©v√©l√© ! ‚ú®</div>
        
        <div class="step-info" id="stepInfo">Mot-cl√© 1/5</div>

        <div class="controls">
          <input id="pwd" autocomplete="off" spellcheck="false" placeholder="Votre r√©ponse..." type="text" />
          <button id="tryBtn">R√©v√©ler</button>
        </div>
        
        <div class="progress-grid" id="progressGrid"></div>
      </div>
    </div>
  </div>

<script>
(function(){
  const STEPS = [
    { key:'souffle' },
    { key:'rire' },
    { key:'trace' },
    { key:'voile' },
    { key:'ombre' }
  ];

  const MAX_STAGE = STEPS.length;
  let stage = MAX_STAGE;
  
  const img = document.getElementById('revealImg');
  const stageLabel = document.getElementById('stage');
  const feedback = document.getElementById('feedback');
  const input = document.getElementById('pwd');
  const tryBtn = document.getElementById('tryBtn');
  const stepInfo = document.getElementById('stepInfo');
  const progressGrid = document.getElementById('progressGrid');
  const victoryMsg = document.getElementById('victoryMsg');
  const frame = document.getElementById('frame');
  const tapHint = document.getElementById('tapHint');

  const blurLevels = [0, 8, 16, 24, 32, 45];

  init();

  function init(){
    for(let i = 0; i < STEPS.length; i++){
      const item = document.createElement('div');
      item.className = 'progress-item';
      item.textContent = i + 1;
      item.id = 'progress_' + i;
      progressGrid.appendChild(item);
    }
    updateVisual();
    updateUI();
    input.focus();
    
    frame.addEventListener('click', () => {
      input.focus();
    });
  }

  tryBtn.addEventListener('click', onTry);
  input.addEventListener('keydown', (e)=>{ 
    if(e.key === 'Enter') onTry(); 
  });

  img.addEventListener('error', ()=>{
    const warn = document.createElement('div');
    warn.style.cssText = "position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#1a1a1a;color:#fff;font-size:14px;text-align:center;padding:20px;border-radius:12px;line-height:1.6";
    warn.innerHTML = "‚ö†Ô∏è Image non trouv√©e<br><br>Placez 'dracula_revelation.png' dans le m√™me dossier";
    frame.appendChild(warn);
  });

  function onTry(){
    const val = normalize(input.value);
    input.value = '';

    const expectedIndex = STEPS.length - stage;
    const expected = STEPS[expectedIndex]?.key;

    if(!val){
      showFeedback('Entrez votre r√©ponse !', 'warn');
      return;
    }

    if(!expected){
      showFeedback('Jeu termin√© ! üéâ', 'ok');
      return;
    }

    if(val === expected){
      markCompleted(expectedIndex);
      if(stage > 0) stage--;
      updateVisual();
      updateUI();

      if(stage === 0){
        victoryMsg.style.display = 'flex';
        addCelebration();
        img.classList.add('revealed');
        tapHint.style.display = 'none';
        showFeedback('üéä Capturez l\'image pour la partager !', 'ok');
      } else {
        const remaining = stage;
        showFeedback(`"${expected}" ‚úì | ${remaining} voile${remaining > 1 ? 's' : ''} restant${remaining > 1 ? 's' : ''}`, 'ok');
        setTimeout(() => input.focus(), 300);
      }
    } else {
      showFeedback('‚ùå Pas le bon mot... Cherchez !', 'err');
      document.querySelector('.card').classList.add('shake');
      setTimeout(() => {
        document.querySelector('.card').classList.remove('shake');
      }, 400);
      setTimeout(() => input.focus(), 400);
    }
  }

  function addCelebration(){
    const emojis = ['üéâ', '‚ú®', 'üéä', 'üëª', 'ü©∏'];
    for(let i = 0; i < 6; i++){
      const el = document.createElement('div');
      el.className = 'completion-celebration';
      el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      el.style.left = (15 + Math.random() * 70) + '%';
      el.style.top = (25 + Math.random() * 50) + '%';
      frame.appendChild(el);
      setTimeout(() => el.remove(), 1200);
    }
  }

  function showFeedback(msg, type){
    feedback.textContent = msg;
    feedback.className = 'feedback ' + type;
    feedback.style.display = 'flex';
    setTimeout(() => {
      feedback.style.display = 'none';
    }, 3800);
  }

  function markCompleted(index){
    const item = document.getElementById('progress_' + index);
    if(item){
      item.classList.add('completed');
      item.textContent = '‚úì';
    }
  }

  function updateVisual(){
    if(stage < 0) stage = 0;
    if(stage > MAX_STAGE) stage = MAX_STAGE;
    
    if(stage === 0){
      img.classList.add('revealed');
    } else {
      img.classList.remove('revealed');
      const blur = blurLevels[stage] ?? 0;
      const brightness = Math.max(0.3, 0.25 + (stage / MAX_STAGE) * 1.1);
      const contrast = 0.65 + (stage / MAX_STAGE) * 0.35;
      
      img.style.filter = `blur(${blur}px) brightness(${brightness}) contrast(${contrast})`;
    }
    
    stageLabel.textContent = `${stage}/${MAX_STAGE}`;
  }

  function updateUI(){
    const nextIndex = STEPS.length - stage;
    
    if(stage === 0){
      stepInfo.textContent = 'Challenge Termin√© ! ü©∏';
    } else {
      stepInfo.textContent = `Mot-cl√© ${nextIndex + 1}/${STEPS.length}`;
    }
    
    for(let i = 0; i < STEPS.length; i++){
      const item = document.getElementById('progress_' + i);
      if(!item) continue;
      
      item.classList.remove('current');
      if(i === nextIndex && stage > 0){
        item.classList.add('current');
      }
    }
  }

  function normalize(s){
    return (s||'').toLowerCase().trim().replace(/\s+/g,'')
      .replace(/[√†√°√¢√§√£√•]/g,'a').replace(/[√®√©√™√´]/g,'e')
      .replace(/[√¨√≠√Æ√Ø]/g,'i').replace(/[√≤√≥√¥√∂√µ]/g,'o')
      .replace(/[√π√∫√ª√º]/g,'u').replace(/[√ß]/g,'c').replace(/[√±]/g,'n');
  }
})();
</script>
</body>
</html>
