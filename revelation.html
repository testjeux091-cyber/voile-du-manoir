<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Le Voile du Manoir</title>
<style>
  :root{--accent:#86c08a;--gold:#f1c40f;--ok:#55d67a}
  *{box-sizing:border-box} html,body{margin:0;height:100%;background:#0d0f13;color:#eee;font:16px/1.4 system-ui,Segoe UI,Arial}
  .wrap{max-width:520px;margin:0 auto;padding:12px}
  .frame{position:sticky;top:0;z-index:1;height:min(62vh,560px);border-radius:14px;overflow:hidden;background:#111;border:1px solid #222}
  .frame img{width:100%;height:100%;object-fit:contain;display:block;
    filter:blur(40px) brightness(.55) contrast(.9) sepia(.25);
    transition:filter .7s ease}
  .frame img.clear{filter:none!important}
  .hud{position:absolute;inset:auto 10px 10px auto;background:#000a;padding:6px 10px;border-radius:999px;font-weight:700;color:var(--gold);border:1px solid #ffffff22}
  .box{margin-top:12px;display:flex;gap:8px}
  input{flex:1;padding:14px;border-radius:12px;border:1px solid #2b2f36;background:#1a1f25;color:#fff;
    -webkit-text-fill-color:#fff;caret-color:#fff;font-weight:700}
  input::placeholder{color:#ffba4a}
  button{padding:14px 16px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--accent),#9cd5a0);color:#0a2b0f;font-weight:800;cursor:pointer}
  .fb{margin-top:10px;padding:10px;border-radius:10px;text-align:center;background:#131821;border:1px solid #242a33;min-height:42px}
  .bar{margin-top:10px;display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
  .bar div{aspect-ratio:1;border:1px solid #2b2f36;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800}
  .bar .on{background:linear-gradient(135deg,var(--ok),#4ade80);color:#0a3614;border-color:var(--ok)}
  .tip{margin-top:8px;font-size:12px;color:#cfcfcf;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="frame">
    <img id="img" src="./dracula_revelation.png" alt="Révélation">
    <div class="hud">Voiles : <span id="left">5</span>/5</div>
  </div>

  <div class="box">
    <input id="in" placeholder="Entrez un mot…">
    <button id="go">Révéler</button>
  </div>

  <div class="fb" id="fb">Clé 1/5</div>

  <div class="bar" id="bar">
    <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div>
  </div>

</div>

<script>
(()=> {
  const KEYS = ['souffle','rire','trace','voile','ombre'];
  let left = KEYS.length; // 5 -> 0

  const img = document.getElementById('img');
  const fb  = document.getElementById('fb');
  const bar = [...document.querySelectorAll('#bar div')];
  const go  = document.getElementById('go');
  const inp = document.getElementById('in');
  const leftEl = document.getElementById('left');

  update();

  go.addEventListener('click', tryWord);
  inp.addEventListener('keydown', e => (e.key==='Enter') && tryWord());

  function tryWord(){
    const v = norm(inp.value); inp.value = ''; inp.focus();
    if(!v) return fb.textContent = 'Tapez un mot.';
    const idx = KEYS.length - left;
    const expect = KEYS[idx];
    if(v === expect){
      left--; bar[idx].classList.add('on');
      fb.textContent = `Clé ${idx+1}/5 : ${expect}`;
      if(left === 0){
        img.classList.add('clear'); // image nette
        fb.textContent = 'Révélation complète !';
      }
    } else {
      fb.textContent = 'Mauvais mot. Relisez le message…';
    }
    update();
    // focus visuel sur l'image
    document.querySelector('.frame').scrollIntoView({behavior:'smooth', block:'start'});
  }

  function update(){
    leftEl.textContent = left;
    if(left===0){ img.classList.add('clear'); }
    else {
      const blur = 8*left, b=0.55+(5-left)*0.08, c=0.9+(5-left)*0.03, s=Math.max(0,0.25-(5-left)*0.05);
      img.style.filter = `blur(${blur}px) brightness(${b}) contrast(${c}) sepia(${s})`;
    }
  }

  function norm(s){
    return (s||'').toLowerCase().trim().replace(/\s+/g,'')
      .replace(/[àáâäãå]/g,'a').replace(/[èéêë]/g,'e').replace(/[ìíîï]/g,'i')
      .replace(/[òóôöõ]/g,'o').replace(/[ùúûü]/g,'u').replace(/ç/g,'c');
  }
})();
</script>
</body>
</html>
