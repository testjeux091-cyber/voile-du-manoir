<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Le Voile du Manoir</title>
<style>
  :root{
    --accent:#86c08a;
    --gold:#f1c40f;
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;
    margin:0;
    padding:0;
    font-family:system-ui,-apple-system,sans-serif;
    background:#000;
    color:#eee;
    overflow:hidden;
  }
  
  .container{
    width:100vw;
    height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    position:relative;
  }
  
  .image-wrapper{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    width:100%;
    height:100%;
  }
  
  #revealImg{
    width:100%;
    height:100%;
    object-fit:contain;
    object-position:center;
    filter:blur(40px) brightness(0.4) contrast(0.8);
    transition:filter 600ms cubic-bezier(0.34,1.56,0.64,1);
    user-select:none;
    -webkit-user-select:none;
  }
  
  #revealImg.revealed{
    filter:none!important;
  }
  
  .input-overlay{
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:20px;
    z-index:10;
    padding:20px;
  }
  
  .input-container{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:16px;
    width:100%;
  }
  
  .step-counter{
    font-size:18px;
    font-weight:700;
    color:var(--gold);
  }
  
  .input-box{
    display:flex;
    align-items:center;
    gap:12px;
    background:rgba(0,0,0,0.7);
    padding:16px;
    border-radius:12px;
    backdrop-filter:blur(10px);
    border:1px solid rgba(134,192,138,0.3);
    width:100%;
    max-width:280px;
    transition:border-color 0.3s, background 0.3s;
  }
  
  .input-box.error{
    border-color:#ff6b6b;
    background:rgba(255,107,107,0.15);
  }
  
  input[type="text"]{
    flex:1;
    padding:12px;
    border:none;
    background:rgba(255,255,255,0.1);
    color:#fff;
    font-size:16px;
    outline:none;
    border-radius:8px;
    -webkit-text-fill-color:#fff;
  }
  
  input::placeholder{
    color:#ffba4a;
  }
  
  input:focus{
    background:rgba(255,255,255,0.15);
  }
  
  .submit-btn{
    padding:12px 16px;
    border:none;
    background:var(--accent);
    color:#08270f;
    font-weight:700;
    cursor:pointer;
    border-radius:8px;
    font-size:20px;
    transition:all 0.2s;
    display:flex;
    align-items:center;
    justify-content:center;
    min-width:50px;
    -webkit-tap-highlight-color:transparent;
  }
  
  .submit-btn:active{
    transform:scale(0.95);
  }
  
  .completion-celebration{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    font-size:60px;
    z-index:20;
    pointer-events:none;
    animation:celebrate 1.2s ease-out forwards;
  }
  
  @keyframes celebrate{
    0%{opacity:1;transform:translate(-50%, -50%) scale(0.5)}
    80%{opacity:1;transform:translate(-50%, -50%) scale(1.2)}
    100%{opacity:0;transform:translate(-50%, -50%) scale(1)}
  }
  
  .shake{
    animation:shake 0.4s ease-in-out;
  }
  
  @keyframes shake{
    0%,100%{transform:translateX(0)}
    25%{transform:translateX(-8px)}
    75%{transform:translateX(8px)}
  }
  
  .victory-screen{
    display:none;
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.8);
    z-index:30;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:20px;
    animation:fadeIn 0.5s ease-out;
  }
  
  .victory-screen.show{
    display:flex;
  }
  
  @keyframes fadeIn{
    from{opacity:0}
    to{opacity:1}
  }
  
  .victory-text{
    font-size:32px;
    font-weight:700;
    color:#55d67a;
    text-align:center;
  }
  
  :root, body {
    color-scheme: dark;
  }
</style>
</head>
<body>
  <div class="container">
    <div class="image-wrapper">
      <img id="revealImg" src="./dracula_revelation.png" alt="Photo mystÃ¨re" />
    </div>
    
    <div class="input-overlay" id="inputOverlay">
      <div class="input-container" id="inputContainer">
        <div class="step-counter" id="stepCounter">1/5</div>
        <div class="input-box" id="inputBox">
          <input id="pwd" type="text" autocomplete="off" spellcheck="false" placeholder="?" />
          <button class="submit-btn" id="tryBtn">âœ“</button>
        </div>
      </div>
    </div>
    
  </div>

<script>
(function(){
  const STEPS = [
    { key:'souffle' },
    { key:'rire' },
    { key:'trace' },
    { key:'voile' },
    { key:'ombre' }
  ];

  const MAX_STAGE = STEPS.length;
  let stage = MAX_STAGE;
  
  const img = document.getElementById('revealImg');
  const input = document.getElementById('pwd');
  const tryBtn = document.getElementById('tryBtn');
  const inputOverlay = document.getElementById('inputOverlay');
  const inputContainer = document.getElementById('inputContainer');
  const stepCounter = document.getElementById('stepCounter');
  const inputBox = document.getElementById('inputBox');

  const blurLevels = [0, 10, 20, 30, 40, 50];

  init();

  function init(){
    updateVisual();
    input.focus();
  }

  tryBtn.addEventListener('click', onTry);
  input.addEventListener('keydown', (e)=>{ 
    if(e.key === 'Enter') onTry(); 
  });

  function onTry(){
    const val = normalize(input.value);
    input.value = '';

    const expectedIndex = STEPS.length - stage;
    const expected = STEPS[expectedIndex]?.key;

    if(!val){
      return;
    }

    if(!expected){
      return;
    }

    if(val === expected){
      if(stage > 0) stage--;
      updateVisual();

      if(stage === 0){
        inputOverlay.style.display = 'none';
        img.classList.add('revealed');
        addCelebration();
      } else {
        inputOverlay.style.display = 'none';
        setTimeout(() => {
          input.value = '';
          inputOverlay.style.display = 'flex';
          input.focus();
        }, 800);
      }
    } else {
      inputBox.classList.add('error');
      setTimeout(() => {
        inputBox.classList.remove('error');
      }, 400);
      input.value = '';
      input.focus();
    }
  }

  function addCelebration(){
    const emojis = ['ðŸŽ‰', 'âœ¨', 'ðŸŽŠ', 'ðŸŽˆ'];
    for(let i = 0; i < 6; i++){
      const el = document.createElement('div');
      el.className = 'completion-celebration';
      el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      el.style.left = (20 + Math.random() * 60) + '%';
      el.style.top = (20 + Math.random() * 60) + '%';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 1200);
    }
  }

  function updateVisual(){
    if(stage < 0) stage = 0;
    if(stage > MAX_STAGE) stage = MAX_STAGE;
    
    const currentStep = STEPS.length - stage + 1;
    stepCounter.textContent = `${currentStep}/${STEPS.length}`;
    
    if(stage === 0){
      img.classList.add('revealed');
    } else {
      img.classList.remove('revealed');
      const blur = blurLevels[stage] ?? 0;
      const brightness = Math.max(0.3, 0.2 + (stage / MAX_STAGE) * 1.2);
      const contrast = 0.7 + (stage / MAX_STAGE) * 0.3;
      
      img.style.filter = `blur(${blur}px) brightness(${brightness}) contrast(${contrast})`;
    }
  }

  function normalize(s){
    return (s||'').toLowerCase().trim().replace(/\s+/g,'')
      .replace(/[Ã Ã¡Ã¢Ã¤Ã£Ã¥]/g,'a').replace(/[Ã¨Ã©ÃªÃ«]/g,'e')
      .replace(/[Ã¬Ã­Ã®Ã¯]/g,'i').replace(/[Ã²Ã³Ã´Ã¶Ãµ]/g,'o')
      .replace(/[Ã¹ÃºÃ»Ã¼]/g,'u').replace(/[Ã§]/g,'c').replace(/[Ã±]/g,'n');
  }
})();
</script>
</body>
</html>
